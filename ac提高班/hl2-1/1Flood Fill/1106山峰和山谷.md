```c++
#include <iostream>
#include <queue>

using namespace std;

const int N = 1010;

int n;
int g[N][N];
bool st[N][N];

void bfs(int x, int y, bool& is_valley, bool& is_peak)
{
    queue<pair<int, int>> q;
    q.push({x, y});
    st[x][y] = true;
    
    int value = g[x][y];
    
    while (q.size())
    {
        auto t = q.front();
        q.pop();
        
        for (int i = -1; i <= 1; i ++ )
            for (int j = -1; j <= 1; j ++ )
            {
                int a = t.first + i, b = t.second + j;
                if (a < 0 || a >= n || b < 0 || b >= n) continue;
                
                if (g[a][b] == value && !st[a][b])
                {
                    st[a][b] = true;
                    q.push({a, b});
                }
                else 
                {
                    if (g[a][b] > value) is_peak = false;
                    if (g[a][b] < value) is_valley = false;
                }
                
            }
    }
}

int main()
{
    cin >> n;
    for (int i = 0; i < n; i ++ )
        for (int j = 0; j < n; j ++ )
            cin >> g[i][j];
    
    int valley = 0, peak = 0;
    for (int i = 0; i < n; i ++ )
        for (int j = 0; j < n; j ++ )
        {
            if (st[i][j]) continue;
            bool is_valley = true, is_peak = true; 
            //只要周围比它高，就不是peak，只要周围比它低， 就不是valley
            bfs(i, j, is_valley, is_peak);
            valley += is_valley;
            peak += is_peak;
        }
    
    cout << peak << ' ' << valley << endl;
    return 0;
}

```


```c++
#include <bits/stdc++.h>

#define x first
#define y second

using namespace std;

typedef pair<int, int> PII;

const int N = 1010, M = N * N;

int n;
int g[N][N];
bool st[N][N];
PII q[M];

void bfs(int sx, int sy, bool& has_higher, bool& has_lower)
{
    int hh = 0, tt = -1;
    q[ ++ tt] = {sx, sy};
    st[sx][sy] = true;

    while (hh <= tt)
    {
        auto t = q[hh ++ ];
        int tag = g[t.x][t.y];

        for (int i = t.x - 1; i <= t.x + 1; i ++ )
            for (int j = t.y - 1; j <= t.y + 1; j ++ )
            {
                if (i == t.x && j == t.y) continue;
                if (i < 0 || i >= n || j < 0 || j >= n) continue;

                if (g[i][j] > tag) has_higher = true;
                if (g[i][j] < tag) has_lower = true;
                
                if (st[i][j]) continue;
                if (g[i][j] == tag)
                {
                    q[ ++ tt] = {i, j};
                    st[i][j] = true; 
                }
            }
    }
}

int main()
{
    cin >> n;
    for (int i = 0; i < n; i ++ )
        for (int j = 0; j < n; j ++ )
            cin >> g[i][j];

    int peak = 0, valley = 0;
    for (int i = 0; i < n; i ++ )
        for (int j = 0; j < n; j ++ )
        {
            if (st[i][j]) continue;
            bool has_higher = false, has_lower = false;
            bfs(i, j, has_higher, has_lower);
            if (!has_higher) peak ++ ;
            if (!has_lower) valley ++ ;
        }
    
    cout << peak << ' ' << valley << endl;
    return 0;
}
```